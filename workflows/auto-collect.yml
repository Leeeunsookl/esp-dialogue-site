import sqlite3, json, os

DB_PATH = "docs/memory.sqlite"
OUT_PATH = "docs/memory.json"

def fetch_memory():
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute("SELECT sentence FROM memory")
    mem = [r[0] for r in cur.fetchall()]
    conn.close()
    return mem

def fetch_chatlogs():
    conn = sqlite3.connect(DB_PATH)
    cur = conn.cursor()
    cur.execute("SELECT message FROM chatlog")
    logs = [r[0] for r in cur.fetchall() if r[0]]
    conn.close()
    return logs

if __name__ == "__main__":
    memory = fetch_memory()
    chats = fetch_chatlogs()
    all_data = list(set(memory + chats))  # 중복 제거
    
    os.makedirs("docs", exist_ok=True)
    with open(OUT_PATH, "w", encoding="utf-8") as f:
        json.dump(all_data, f, ensure_ascii=False, indent=2)
    
    print(f"Exported {len(all_data)} sentences (memory + chatlogs) → {OUT_PATH}")
