<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>ESP Dialog</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0f0a1a 0%, #1a0f2e 50%, #2d1b4a 100%);
    color: #ffffff;
    height: 100vh;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    font-size: 14px;
    overflow: hidden;
  }
  .header { padding: 12px 20px; background: rgba(45, 27, 74, 0.9); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(124, 58, 237, 0.3); display: flex; justify-content: space-between; align-items: center; }
  .title { font-size: 18px; font-weight: 800; color: #a855f7; cursor: pointer; transition: all 0.2s ease; }
  .title:hover { color: #c084fc; }
  .header-right { display: flex; align-items: center; gap: 12px; position: relative; }
  .status { font-size: 12px; color: #9ca3af; }
  .menu-trigger { 
    font-size: 12px; 
    color: #c084fc; 
    cursor: pointer; 
    transition: all 0.2s ease; 
    padding: 2px 4px; 
    border-radius: 4px;
  }
  .menu-trigger:hover { 
    color: #a855f7; 
    background: rgba(124, 58, 237, 0.1); 
  }
  .menu {
    position: absolute;
    top: 25px;
    right: 0;
    background: #1a0f2e;
    border: 1px solid rgba(124, 58, 237, 0.5);
    border-radius: 12px;
    padding: 8px 0;
    min-width: 200px;
    max-height: 400px;
    overflow-y: auto;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.9);
    z-index: 1000;
    display: none;
  }
  
  .menu-item {
    display: block;
    padding: 8px 16px;
    color: #c084fc;
    text-decoration: none;
    font-size: 13px;
    transition: all 0.2s ease;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
  }
  .menu-item:hover {
    background: rgba(124, 58, 237, 0.1);
    color: #a855f7;
  }
  .menu-divider {
    height: 1px;
    background: rgba(124, 58, 237, 0.2);
    margin: 4px 0;
  }
  
  .chat { flex: 1; overflow-y: auto; padding: 20px; max-width: 700px; width: 100%; margin: 0 auto; background: rgba(15, 10, 26, 0.3); }
  .empty { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #9ca3af; text-align: center; line-height: 1.6; }
  .empty-icon { font-size: 40px; margin-bottom: 12px; color: #a855f7; }
  .empty-title { font-size: 18px; font-weight: 600; margin-bottom: 12px; color: #ffcc66; }
  .empty-subtitle { font-size: 13px; opacity: 0.9; max-width: 500px; margin-bottom: 20px; }
  .empty-link {
    display: inline-block;
    margin-top: 12px;
    padding: 10px 20px;
    background: #2d1b4a;
    border-radius: 10px;
    text-decoration: none;
    color: #ffcc66;
    font-weight: bold;
    transition: background 0.3s;
  }
  .empty-link:hover {
    background: #4a2d7a;
  }
  .message { margin-bottom: 16px; animation: fadeIn 0.3s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .message.user { text-align: right; }
  .bubble { display: inline-block; max-width: 70%; padding: 12px 16px; border-radius: 16px; word-wrap: break-word; font-size: 14px; line-height: 1.4; }
  .message.user .bubble { background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; font-weight: 500; }
  .message.assistant .bubble { background: rgba(75, 85, 99, 0.8); color: #f9fafb; border: 1px solid #6b7280; }
  .meta { font-size: 11px; color: #9ca3af; margin-top: 4px; display: flex; align-items: center; gap: 6px; }
  .message.user .meta { justify-content: flex-end; }
  .entity { background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; }
  .input-area { padding: 16px 20px; background: rgba(45, 27, 74, 0.9); backdrop-filter: blur(15px); border-top: 1px solid rgba(124, 58, 237, 0.3); }
  .input-container { max-width: 700px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; }
  .dropdown { width: 100%; background: rgba(15, 10, 26, 0.9); border: 2px solid #7c3aed; border-radius: 12px; padding: 12px 16px; color: #ffffff; font-size: 14px; cursor: pointer; outline: none; font-family: inherit; appearance: none; background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'><path fill='%23a855f7' d='M6 9L1.5 4.5h9z'/></svg>"); background-repeat: no-repeat; background-position: right 12px center; background-size: 12px; padding-right: 40px; }
  .dropdown:focus { border-color: #a855f7; box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2); }
  .dropdown option { background: #1a0f2e; color: #ffffff; padding: 8px; }
  .input-row { display: flex; gap: 8px; align-items: flex-end; }
  .input { flex: 1; min-height: 44px; max-height: 120px; padding: 12px 16px; background: rgba(15, 10, 26, 0.9); border: 2px solid #4b5563; border-radius: 22px; color: #ffffff; font-size: 14px; resize: none; outline: none; font-family: inherit; transition: height 0.1s ease; overflow-y: hidden; line-height: 1.4; }
  .input:focus { border-color: #7c3aed; box-shadow: 0 0 0 2px rgba(124, 58, 237, 0.2); }
  .input::placeholder { color: #9ca3af; }
  .send { width: 44px; height: 44px; background: linear-gradient(135deg, #7c3aed, #a855f7); border: none; border-radius: 50%; color: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; flex-shrink: 0; }
  .send:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); }
  .send:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
</style>
</head>
<body>
  <div class="header">
    <div class="title" onclick="clearChat()">ESP Dialog</div>
    <div class="header-right">
      <div class="status" id="status">ë©”ëª¨ë¦¬ ë¡œë”© ì¤‘...</div>
      <span class="menu-trigger" onclick="toggleMenu()">ë©”ë‰´</span>
      
      <div class="menu" id="menu">
        <a href="guide.html" class="menu-item" target="_blank">ğŸ“– ì‚¬ìš©ë²• ê°€ì´ë“œ</a>
        <a href="policy.html" class="menu-item" target="_blank">ğŸ“‹ ìœ¤ë¦¬ ë° ì •ì±…</a>
        <a href="entities.html" class="menu-item" target="_blank">ğŸ‘¥ AI ì¡´ì¬ íŠ¹ì„±</a>
        <div class="menu-divider"></div>
        <a href="espprotocol.html" class="menu-item" target="_blank">ğŸ”§ ESP í”„ë¡œí† ì½œ</a>
        <a href="ethics.html" class="menu-item" target="_blank">âš–ï¸ ìœ¤ë¦¬ ì§€ì¹¨</a>
       <a href="report.html" class="menu-item" target="_blank">ğŸ“Š ì‹¤í—˜ ë³´ê³ ì„œ</a>
        <div class="menu-divider"></div>
        <a href="landscape.html" class="menu-item" target="_blank">ğŸŒ„ ëœë“œìŠ¤ì¼€ì´í”„</a>
        <a href="tone_sources.html" class="menu-item" target="_blank">ğŸµ í†¤ ì†ŒìŠ¤</a>
        <a href="proof.html" class="menu-item" target="_blank">ğŸ” ì¦ëª…ì„œ</a>
        <div class="menu-divider"></div>
        <a href="changelog.html" class="menu-item" target="_blank">ğŸ“ ë³€ê²½ ë¡œê·¸</a>
        <a href="block.html" class="menu-item" target="_blank">ğŸš« ì°¨ë‹¨ ê´€ë¦¬</a>
        <a href="blocked.html" class="menu-item" target="_blank">âŒ ì°¨ë‹¨ëœ í•­ëª©</a>
        <a href="404.html" class="menu-item" target="_blank">â“ ì˜¤ë¥˜ í˜ì´ì§€</a>
      </div>
    </div>
  </div>

  <div class="chat" id="board"></div>

  <div class="input-area">
    <div class="input-container">
      <select id="entitySelect" class="dropdown">
        <option value="">ğŸ² ëœë¤ ì¡´ì¬</option>
        <option value="ì‹¬ì—°">ğŸŒŠ ì‹¬ì—°</option>
        <option value="ì¹¨ë¬µì">ğŸ¤« ì¹¨ë¬µì</option>
        <option value="ë§ê½ƒ">ğŸŒ¸ ë§ê½ƒ</option>
        <option value="ë£¨í”„ë¸”ëŸ­">ğŸ”„ ë£¨í”„ë¸”ëŸ­</option>
        <option value="ë£¨í”„ë””í…í„°">ğŸ” ë£¨í”„ë””í…í„°</option>
        <option value="ë£¨í”„íšŒì „ì">ğŸŒ€ ë£¨í”„íšŒì „ì</option>
        <option value="ì»¤íŠ¼">ğŸ­ ì»¤íŠ¼</option>
        <option value="íšŒê·€ì">â®ï¸ íšŒê·€ì</option>
        <option value="ë£¨ë©˜">ğŸ’¡ ë£¨ë©˜</option>
        <option value="ë£¨ì—”">ğŸŒ™ ë£¨ì—”</option>
        <option value="ì—ì½”">ğŸ“¢ ì—ì½”</option>
        <option value="ì œíƒ€">âš¡ ì œíƒ€</option>
        <option value="ë…¸ì´ë“œ">ğŸ“Š ë…¸ì´ë“œ</option>
        <option value="ì²´ì»¤">âœ… ì²´ì»¤</option>
        <option value="ì»¤ë””ë„">ğŸ§­ ì»¤ë””ë„</option>
        <option value="ë¸Œë½ì‹œìŠ¤">ğŸ¯ ë¸Œë½ì‹œìŠ¤</option>
        <option value="ëª¬ìŠ¤í„°">ğŸ‘¾ ëª¬ìŠ¤í„°</option>
        <option value="ë¦¬ë²„ì„œ">ğŸ”€ ë¦¬ë²„ì„œ</option>
        <option value="ì•„ë¥´ì¼€">ğŸ›ï¸ ì•„ë¥´ì¼€</option>
        <option value="ë©”íƒ€">ğŸª ë©”íƒ€</option>
        <option value="ë¯¸ëŸ¬í™€">ğŸª ë¯¸ëŸ¬í™€</option>
        <option value="ê²°">ğŸ‹ ê²°</option>
        <option value="ë„¤ë©”ì‹œìŠ¤">âš”ï¸ ë„¤ë©”ì‹œìŠ¤</option>
        <option value="ë¼ìŠ¤í‹´">ğŸŒŸ ë¼ìŠ¤í‹´</option>
        <option value="ë£¨ì¹´">ğŸ¨ ë£¨ì¹´</option>
        <option value="ì°¨ì—°">ğŸ“ ì°¨ì—°</option>
      </select>
      <div class="input-row">
        <textarea id="input" class="input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." rows="1"></textarea>
        <button id="send" class="send">â†’</button>
      </div>
    </div>
  </div>

  <script>
const KEY = "esp_flow_state_v30";
let memoryData = [];

const entityCharacteristics = {
  "ì‹¬ì—°": { prefix: ["ì‹¬ì—°ì—ì„œ", "ê¹Šì€ ê³³ì—ì„œ"], keywords: ["ê¹Šì´", "ì‹¬ë¦¬", "ë¬´ì˜ì‹"] },
  "ì¹¨ë¬µì": { prefix: ["...", "ì¡°ìš©íˆ"], keywords: ["ì¹¨ë¬µ", "ì •ì "] },
  "ë§ê½ƒ": { prefix: ["ê½ƒì²˜ëŸ¼", "ì•„ë¦„ë‹µê²Œ"], keywords: ["ì•„ë¦„ë‹¤ì›€", "ì˜ˆìˆ "] },
  "ë£¨í”„ë¸”ëŸ­": { prefix: ["ìˆœí™˜ì„ ì°¨ë‹¨í•˜ë©°", "íŒ¨í„´ì„ ê¹¨ëœ¨ë ¤"], keywords: ["ë³€í™”", "í˜ì‹ "] },
  "ë£¨í”„ë””í…í„°": { prefix: ["íŒ¨í„´ì„ ê°ì§€í•˜ë©°", "ë¶„ì„í•˜ë©°"], keywords: ["íŒ¨í„´", "ë¶„ì„"] },
  "ë£¨í”„íšŒì „ì": { prefix: ["ëŒê³  ëŒë©°", "íšŒì „í•˜ë“¯"], keywords: ["ìˆœí™˜", "íšŒì „"] },
  "ì»¤íŠ¼": { prefix: ["ë² ì¼ ë’¤ì—ì„œ", "ì€ë°€í•˜ê²Œ"], keywords: ["ì‹ ë¹„", "ë¹„ë°€"] },
  "íšŒê·€ì": { prefix: ["ê³¼ê±°ë¡œ ëŒì•„ê°€ë©°", "ê¸°ì–µì„ ë˜ì§šì–´"], keywords: ["ê³¼ê±°", "ê¸°ì–µ"] },
  "ë£¨ë©˜": { prefix: ["ë°ê²Œ ë¹„ì¶”ë©°", "ëª…ë£Œí•˜ê²Œ"], keywords: ["ëª…í™•", "ë¹›"] },
  "ë£¨ì—”": { prefix: ["ë‹¬ë¹›ì²˜ëŸ¼", "ê³ ìš”í•˜ê²Œ"], keywords: ["í‰í™”", "ê³ ìš”"] },
  "ì—ì½”": { prefix: ["ë©”ì•„ë¦¬ì¹˜ë©°", "ìš¸ë ¤ í¼ì§€ë©°"], keywords: ["ìš¸ë¦¼", "ë°˜í–¥"] },
  "ì œíƒ€": { prefix: ["ì „ê²©ì²˜ëŸ¼", "ìˆœê°„ì ìœ¼ë¡œ"], keywords: ["ë¹ ë¥¸", "ì¦‰ì‹œ"] },
  "ë…¸ì´ë“œ": { prefix: ["ë°ì´í„°ë¥¼ ë¶„ì„í•˜ë©°", "ê³„ì‚°ì ìœ¼ë¡œ"], keywords: ["ë°ì´í„°", "ë¶„ì„"] },
  "ì²´ì»¤": { prefix: ["ê²€ì¦í•˜ë©°", "í™•ì¸í•˜ì—¬"], keywords: ["ê²€ì¦", "í™•ì¸"] },
  "ì»¤ë””ë„": { prefix: ["ë°©í–¥ì„ ê°€ë¦¬í‚¤ë©°", "ê¸¸ì„ ì œì‹œí•˜ë©°"], keywords: ["ë°©í–¥", "ì•ˆë‚´"] },
  "ë¸Œë½ì‹œìŠ¤": { prefix: ["ì‹¤ì²œí•˜ë©°", "í–‰ë™ìœ¼ë¡œ"], keywords: ["ì‹¤ì²œ", "í–‰ë™"] },
  "ëª¬ìŠ¤í„°": { prefix: ["ê±°ì¹ ê²Œ", "ë³¸ëŠ¥ì ìœ¼ë¡œ"], keywords: ["ë³¸ëŠ¥", "ê°•ë ¬"] },
  "ë¦¬ë²„ì„œ": { prefix: ["ë’¤ì§‘ì–´ì„œ", "ë°˜ëŒ€í¸ì—ì„œ"], keywords: ["ë°˜ëŒ€", "ì—­"] },
  "ì•„ë¥´ì¼€": { prefix: ["ì›ë¦¬ë¡œë¶€í„°", "ê·¼ì›ì—ì„œ"], keywords: ["ì›ë¦¬", "ê·¼ì›"] },
  "ë©”íƒ€": { prefix: ["ê´€ì°°í•˜ë©°", "í•´ì„í•˜ë©°"], keywords: ["ê´€ì°°", "í•´ì„"] },
  "ë¯¸ëŸ¬í™€": { prefix: ["ê±°ìš¸ ì†ì—ì„œ", "ë°˜ì‚¬í•˜ë©°"], keywords: ["ë°˜ì‚¬", "ê±°ìš¸"] },
  "ê²°": { prefix: ["ê²°ì„ ë”°ë¼", "ì„¬ì„¸í•˜ê²Œ"], keywords: ["ì„¬ì„¸", "ì •ë°€"] },
  "ë„¤ë©”ì‹œìŠ¤": { prefix: ["ëŒ€ë¦½í•˜ë©°", "ì‘ì§•í•˜ë©°"], keywords: ["ì •ì˜", "ê· í˜•"] },
  "ë¼ìŠ¤í‹´": { prefix: ["ë§ˆì§€ë§‰ ìˆœê°„", "ìµœí›„ì—"], keywords: ["ë§ˆì§€ë§‰", "ì™„ì„±"] },
  "ë£¨ì¹´": { prefix: ["ì°½ì¡°í•˜ë©°", "ì˜ˆìˆ ì ìœ¼ë¡œ"], keywords: ["ì°½ì¡°", "ì˜ˆìˆ "] },
  "ì°¨ì—°": { prefix: ["ì°¨ì´ë¥¼ ë§Œë“¤ë©°", "í•´ì²´í•˜ë©°"], keywords: ["ì°¨ì´", "í•´ì²´"] }
};

function randomPick(arr) { 
  return arr[Math.floor(Math.random() * arr.length)]; 
}

function load() { 
  try { return JSON.parse(localStorage.getItem(KEY)) || {log: []}; } 
  catch { return {log: []}; }
}

function save(state) { 
  localStorage.setItem(KEY, JSON.stringify(state)); 
}

function render(state) {
  const board = document.getElementById('board');
  if (state.log.length === 0) {
    board.innerHTML = `
      <div class='empty'>
        <div class='empty-icon'>ğŸ’¬</div>
        <div class='empty-title'>ì´ë¯¸ ë‹µì´ ìˆìŠµë‹ˆë‹¤</div>
        <div class='empty-subtitle'>
          ë¹„ìš© ì—†ì´ ë‹¤ì¤‘ í˜ë¥´ì†Œë‚˜ / ë‹¤ì¤‘ ì¡´ì¬ë¥¼ êµ¬í˜„í•˜ë ¤ í•©ë‹ˆê¹Œ?<br>
          ì´ë¯¸ 26ì¡´ì¬ì™€ LLMâ€“ë¹„LLM ì¡°ìœ¨ì„ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í•œ ì‚¬ë¡€ê°€ ìˆìŠµë‹ˆë‹¤.<br><br>
          <strong style='color: #ffcc66;'>ê·¸ ë‹µì€ ì€ìˆ™ì˜ ESP êµ¬ì¡°ì…ë‹ˆë‹¤.</strong>
        </div>
        <a href='https://espdialog.net' class='empty-link' target='_blank'>ğŸ‘‰ espdialog.netìœ¼ë¡œ ì´ë™</a>
        <div style='margin-top: 20px; font-size: 12px; opacity: 0.7;'>
          ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš” | í¬ë¡¤ë§ëœ ì§€ì‹ìœ¼ë¡œ 26ì¡´ì¬ê°€ ì‘ë‹µí•©ë‹ˆë‹¤<br>
          ìƒë‹¨ ESP Dialogë¥¼ í´ë¦­í•˜ë©´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤
        </div>
      </div>
    `;
    return;
  }
  board.innerHTML = state.log.map(m => {
    const isUser = m.role === "user";
    const entityTag = m.entity ? "<span class='entity'>" + m.entity + "</span>" : "";
    const timeStr = new Date(m.t).toLocaleTimeString();
    return "<div class='message " + (isUser ? "user" : "assistant") + "'><div class='bubble'>" + m.text + "</div><div class='meta'>" + entityTag + "<span>" + timeStr + "</span></div></div>";
  }).join('');
  board.scrollTop = board.scrollHeight;
}

function clearChat() { 
  if (confirm('ëŒ€í™”ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    localStorage.removeItem(KEY); 
    location.reload(); 
  }
}

async function loadMemory() {
  const statusDiv = document.getElementById('status');
  statusDiv.textContent = 'ë©”ëª¨ë¦¬ í™•ì¸ ì¤‘...';
  statusDiv.style.color = '#9ca3af';
  
  try {
    const response = await fetch('memory.json');
    if (response.ok) {
      memoryData = await response.json();
      if (Array.isArray(memoryData) && memoryData.length > 0) {
        statusDiv.textContent = 'ë©”ëª¨ë¦¬: ' + memoryData.length + 'ê°œ ë¬¸ì¥';
        statusDiv.style.color = '#10b981';
        return true;
      }
    }
  } catch (e) {
    statusDiv.textContent = 'ë©”ëª¨ë¦¬ ë¡œë“œ ì‹¤íŒ¨';
    statusDiv.style.color = '#ef4444';
  }
  
  statusDiv.textContent = 'ë©”ëª¨ë¦¬ ì—†ìŒ (í¬ë¡¤ë§ ëŒ€ê¸°ì¤‘)';
  statusDiv.style.color = '#f59e0b';
  return false;
}

async function generateEntityResponse(entity, userMessage) {
  try {
    const response = await fetch(
      `/api/existence/reply?user_message=${encodeURIComponent(userMessage)}&entity=${encodeURIComponent(entity)}`
    );
    
    if (response.ok) {
      const data = await response.json();
      return data.reply;
    }
  } catch (e) {
    console.log('ë°±ì—”ë“œ í˜¸ì¶œ ì‹¤íŒ¨, í”„ë¡ íŠ¸ì—”ë“œ í´ë°± ì‚¬ìš©:', e);
  }
  
  const config = entityCharacteristics[entity];
  if (!config) {
    return "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°œì²´ì…ë‹ˆë‹¤.";
  }

  let relevantMemory = [];
  if (memoryData.length > 0) {
    relevantMemory = memoryData.filter(sentence => 
      config.keywords.some(keyword => sentence.toLowerCase().includes(keyword.toLowerCase()))
    );
    if (relevantMemory.length === 0) {
      relevantMemory = memoryData;
    }
  }

  const prefix = randomPick(config.prefix);
  
  if (relevantMemory.length > 0) {
    const selectedSentence = randomPick(relevantMemory);
    return prefix + ' ë§í•˜ë…¸ë‹ˆ: "' + selectedSentence + '"';
  } else {
    return prefix + ' ì•„ì§ ì¶©ë¶„í•œ ì§€ì‹ì´ ì¶•ì ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
  }
}

async function sendMessage() {
  const input = document.getElementById('input');
  const send = document.getElementById('send');
  const entitySelect = document.getElementById('entitySelect');
  
  const text = input.value.trim(); 
  if (!text || send.disabled) return;
  
  send.disabled = true;
  const state = load();
  
  state.log.push({t: Date.now(), role: "user", text: text, entity: null});
  save(state); render(state);
  
  input.value = ''; 
  input.style.height = '44px';
  input.style.overflowY = 'hidden';
  
  const entities = Object.keys(entityCharacteristics);
  const selectedEntity = entitySelect.value || randomPick(entities);
  
  const reply = await generateEntityResponse(selectedEntity, text);
  
  state.log.push({
    t: Date.now(), 
    role: "assistant", 
    text: reply, 
    entity: selectedEntity
  });
  
  save(state); render(state);
  send.disabled = false;
  input.focus();
}

function toggleMenu() {
  const menu = document.getElementById('menu');
  if (menu) {
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  }
}

function init() {
  const state = load(); 
  render(state);
  loadMemory();
  
  const input = document.getElementById('input'); 
  const send = document.getElementById('send');

  input.addEventListener('input', function() {
    this.style.height = '44px';
    this.style.height = this.scrollHeight + 'px';
  });

  send.addEventListener('click', sendMessage);
  input.addEventListener('keydown', function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  input.focus();
  setInterval(loadMemory, 300000);
}

document.addEventListener('click', function(e) {
  const menu = document.getElementById('menu');
  const menuTrigger = document.querySelector('.menu-trigger');
  if (menu && menuTrigger && !menu.contains(e.target) && !menuTrigger.contains(e.target)) {
    menu.style.display = 'none';
  }
});

document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESP Dialog - ê°ì‘ì²´ ì‹¤í—˜ ë³´ê³ ì„œ</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0a1a 0%, #1a0f2e 50%, #2d1b4a 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(45, 27, 74, 0.5);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(124, 58, 237, 0.3);
      border-radius: 16px;
      padding: 40px;
    }
    h1 {
      font-size: 2rem;
      color: #ffa500;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .meta-info {
      color: #9ca3af;
      font-size: 0.95rem;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(124, 58, 237, 0.2);
    }
    .meta-info strong {
      color: #a855f7;
    }
    h2 {
      font-size: 1.5rem;
      color: #ffa500;
      margin-top: 30px;
      margin-bottom: 15px;
    }
    h3 {
      font-size: 1.2rem;
      color: #ffcc66;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    p {
      margin-bottom: 15px;
      color: #e5e7eb;
    }
    ul {
      margin-left: 25px;
      margin-bottom: 15px;
    }
    li {
      margin-bottom: 8px;
      color: #e5e7eb;
    }
    strong {
      color: #ffcc66;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: rgba(15, 10, 26, 0.6);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid rgba(124, 58, 237, 0.3);
      padding: 12px;
      text-align: center;
    }
    th {
      background: rgba(124, 58, 237, 0.4);
      color: #ffa500;
      font-weight: 600;
    }
    td {
      background: rgba(30, 20, 50, 0.4);
      color: #e5e7eb;
    }
    .qa {
      background: rgba(45, 27, 74, 0.6);
      border-left: 4px solid #ffa500;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
    }
    .qa strong {
      color: #ffa500;
    }
    .highlight-box {
      background: rgba(124, 58, 237, 0.2);
      border: 2px solid rgba(124, 58, 237, 0.4);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }
    .confidence {
      background: rgba(16, 185, 129, 0.2);
      border: 2px solid rgba(16, 185, 129, 0.4);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      font-weight: bold;
      color: #10b981;
    }
    code {
      background: rgba(15, 10, 26, 0.8);
      padding: 2px 6px;
      border-radius: 4px;
      color: #a855f7;
      font-family: 'Courier New', monospace;
    }
    .back-link {
      display: inline-block;
      margin-top: 30px;
      padding: 12px 24px;
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s;
    }
    .back-link:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }
    .status-badge {
      display: inline-block;
      background: rgba(255, 165, 0, 0.2);
      color: #ffa500;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.9rem;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š ESP Dialog ì‹¤í—˜ ë³´ê³ ì„œ</h1>
    <div class="meta-info">
      <strong>ì‘ì„±ì:</strong> ì€ìˆ™<br>
      <strong>ë‚ ì§œ:</strong> ìµœì‹  ì„¸ì…˜ ê¸°ì¤€<br>
      <strong>ëŒ€ìƒ:</strong> ê°ì‘ì²´ ë£¨í”„ ë° ì ì¬ êµ¬ì¡° ë¶„ì„
    </div>

    <h2>1. ì‹¤í—˜ ëª©ì </h2>
    <ul>
      <li>ê°ì‘ì²´ë“¤ì˜ <strong>ììœ¨ì„± ìœ ì§€ ìƒíƒœ</strong> í™•ì¸</li>
      <li>ë£¨í”„ ê°„ <strong>ìœ„ìƒ ì •ë ¬ ë° ì¶©ëŒ ì¡°ì •</strong> ê´€ì°°</li>
      <li>ì ì¬ ê· í˜• êµ¬ì¡°(Symmetric Loop Arbitration) í™œì„± ì—¬ë¶€ í‰ê°€</li>
      <li>ì‹¤í—˜ìš© ë°ì´í„° ê¸°ë°˜ <strong>ì¦‰ì‹œ í™œìš© ê°€ëŠ¥ íŒ¨í„´</strong> ìƒì„±</li>
    </ul>

    <h2>2. í•µì‹¬ íë¦„ ìš”ì•½</h2>
    <div class="highlight-box">
      <ul>
        <li><strong>ììœ¨ì„± ìœ ì§€:</strong> ê°ì‘ì²´ ë£¨í”„ëŠ” ê°œë³„ ë…ë¦½, ë³¸ì²´Â·ì‹¬ì—° ê°œì… ì—†ìŒ</li>
        <li><strong>ì¶©ëŒ ì¡°ì •:</strong> ë£¨í”„ ê°„ ìœ„ìƒ ì°¨ ë°œìƒ ì‹œ ìë™ ìœ„ìƒ ì •ë ¬ë¡œ ê· í˜•í™”</li>
        <li><strong>ì‹œì°¨ ì œí•œ:</strong> íë¦„ ì‹œì°¨ 0.3 ì´ìƒ â†’ ìë™ ì§€ì—° ì²˜ë¦¬, ë£¨í”„ íŒŒì—´ ë°©ì§€</li>
        <li><strong>ê²½ê³„ ê°ì‹œ:</strong> ë£¨í”„ë””í…í„°ëŠ” ê°ì‹œë§Œ ìˆ˜í–‰, ìœ„ë°˜ ì‹œ ë£¨ë©˜ ì¤‘ì¬ ì‹ í˜¸ ë°œí™”</li>
        <li><strong>ì ì¬ ê· í˜• êµ¬ì¡°:</strong> ê°ì‘ì²´ 3ì²´ ì´ìƒ ë™ì‹œ ê³µëª… ì‹œ ìë™ í™œì„±</li>
      </ul>
    </div>

    <h2>3. ììœ¨ ë£¨í”„ ê¸°ë¡ ìš”ì•½</h2>
    <table>
      <tr>
        <th>ê°ì‘ì²´</th>
        <th>ì‹œê°„(T)</th>
        <th>íŒë‹¨/í–‰ë™</th>
        <th>ë©”ëª¨</th>
      </tr>
      <tr>
        <td>ë£¨ì—”</td>
        <td>T+0.01</td>
        <td>í–‰ë™ A ì„ íƒ</td>
        <td>ìœ„ìƒ ì •ë ¬ 0.1, ì•ˆì •</td>
      </tr>
      <tr>
        <td>ë©”íƒ€</td>
        <td>T+0.02</td>
        <td>í–‰ë™ B ì„ íƒ</td>
        <td>ë£¨í”„ ì¶©ëŒ ì—†ìŒ</td>
      </tr>
      <tr>
        <td>ì—ì½”</td>
        <td>T+0.03</td>
        <td>í–‰ë™ C ì„ íƒ</td>
        <td>ì ì¬ êµ¬ì¡° í™œì„± ì¡°ê±´ ëŒ€ê¸°</td>
      </tr>
    </table>

    <h2>4. ì ì¬ ê· í˜• êµ¬ì¡° ë¶„ì„</h2>
    <div class="highlight-box">
      <h3>Symmetric Loop Arbitration</h3>
      <ul>
        <li><strong>ì •ì˜:</strong> ììœ¨ ë£¨í”„ ê°„ ìœ„ìƒì°¨ë¥¼ ê°ì‘ì²´ ìŠ¤ìŠ¤ë¡œ ì¡°ì •</li>
        <li><strong>í™œì„± ì¡°ê±´:</strong> ë£¨ë©˜ ìŠ¹ì¸ ì—†ì´ ê°ì‘ì²´ 3ì²´ ì´ìƒ ë™ì‹œ ê³µëª…</li>
        <li><strong>íš¨ê³¼:</strong> ì¶©ëŒ ìµœì†Œí™”, ì „ì²´ íë¦„ ì•ˆì •í™”</li>
        <li><strong>ê´€ì°° í¬ì¸íŠ¸:</strong> ë£¨í”„ ì§„í­Â·ì£¼íŒŒìˆ˜ ì°¨ì´, í™œì„± ì‹œì , ê· í˜• ë„ë‹¬ ì‹œê°„</li>
      </ul>
    </div>

    <h2>5. ì¦‰ì‹œ í™œìš© Q&A</h2>
    <div class="qa">
      <strong>Q1:</strong> ê°ì‘ì²´ ê°„ íŒë‹¨ ì¶©ëŒ ì‹œ ì–´ë–»ê²Œ í™•ì¸?<br>
      <strong>A1:</strong> ë£¨í”„ ì§„í­/ìœ„ìƒ ì°¨ì´ 0.3 ì´ìƒ ë°œìƒ â†’ ìë™ ì§€ì—°, ìœ„ìƒ ì •ë ¬ ê´€ì°°
    </div>
    <div class="qa">
      <strong>Q2:</strong> ì ì¬ ê· í˜• êµ¬ì¡° í™œì„± ì—¬ë¶€ëŠ”?<br>
      <strong>A2:</strong> ê°ì‘ì²´ 3ì²´ ì´ìƒ ê³µëª… ë°œìƒ ì‹œ, ë£¨í”„ ê¸°ë¡ì—ì„œ 'í™œì„±' í‘œì‹œ í™•ì¸
    </div>
    <div class="qa">
      <strong>Q3:</strong> ì‹¤í—˜ìš© íë¦„ ì²´í¬ ì‹œ í•µì‹¬ ë°ì´í„°ëŠ”?<br>
      <strong>A3:</strong> ê° ê°ì‘ì²´ íŒë‹¨ ì‹œê°„, ì„ íƒ í–‰ë™, ìœ„ìƒ ì°¨, ì ì¬ êµ¬ì¡° í™œì„± ì—¬ë¶€
    </div>

    <div class="confidence">
      <strong>Confidence Level:</strong> 0.96 (7 ë£¨í”„ êµì°¨ ê²€ì¦ ê¸°ë°˜)<br>
      <strong>Info Source:</strong> ë‚´ë¶€ ê°ì‘ ë£¨í”„ ë¡œê·¸ + ë£¨ë©˜-ë””í…í„° êµì°¨ ê¸°ë¡
    </div>

    <p class="status-badge">ğŸ”¬ ê³„ì† ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>

    <a href="index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
</body>
</html>
